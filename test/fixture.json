{
  "openapi":"3.1.0",
  "info":{
    "title":"customer-identity",
    "version":"1.0",
    "description":""
  },
  "servers":[
    {
      "url":"http://localhost:3000"
    }
  ],
  "paths":{
    "/businesses/{businessId}":{
      "parameters":[
        {
          "$ref":"#/components/parameters/businessId"
        }
      ],
      "get":{
        "summary":"Get Business",
        "responses":{
          "200":{
            "$ref":"#/components/responses/BusinessResponse"
          }
        },
        "operationId":"getBusiness"
      },
      "patch":{
        "summary":"Patch Business",
        "operationId":"patchBusiness",
        "responses":{
          "200":{
            "$ref":"#/components/responses/BusinessResponse"
          }
        },
        "requestBody":{
          "$ref":"#/components/requestBodies/BusinessPatchRequest"
        }
      },
      "post":{
        "summary":"Create Business",
        "operationId":"createBusiness",
        "responses":{
          "200":{
            "$ref":"#/components/responses/BusinessResponse"
          }
        },
        "requestBody":{
          "$ref":"#/components/requestBodies/BusinessPostRequest"
        }
      }
    },
    "/businesses/{businessId}/persons/{personId}":{
      "parameters":[
        {
          "$ref":"#/components/parameters/businessId"
        },
        {
          "$ref":"#/components/parameters/personId"
        }
      ],
      "get":{
        "summary":"Get Person",
        "responses":{
          "200":{
            "$ref":"#/components/responses/PersonResponse"
          }
        },
        "operationId":"getPerson"
      },
      "patch":{
        "summary":"Patch Person",
        "operationId":"patchPerson",
        "responses":{
          "200":{
            "$ref":"#/components/responses/PersonResponse"
          }
        },
        "requestBody":{
          "$ref":"#/components/requestBodies/PersonPatchRequest"
        }
      }
    }
  },
  "components":{
    "schemas":{
      "PhoneNumber":{
        "type":"string",
        "title":"Phone Number",
        "pattern":"^\\+[1-9]\\d{1,14}$",
        "example":"+19028081384"
      },
      "Address":{
        "title":"Address",
        "type":"object",
        "properties":{
          "line1":{
            "type":"string",
            "example":"18 West 18th Street"
          },
          "line2":{
            "type":"string",
            "example":"Floor 5"
          },
          "city":{
            "type":"string",
            "example":"New York"
          },
          "state":{
            "type":"string",
            "example":"NY",
            "enum":[
              "AL",
              "AK",
              "AS",
              "AZ",
              "AR",
              "CA",
              "CO",
              "CT",
              "DE",
              "DC",
              "FM",
              "FL",
              "GA",
              "GU",
              "HI",
              "ID",
              "IL",
              "IN",
              "IA",
              "KS",
              "KY",
              "LA",
              "ME",
              "MH",
              "MD",
              "MA",
              "MI",
              "MN",
              "MS",
              "MO",
              "MT",
              "NE",
              "NV",
              "NH",
              "NJ",
              "NM",
              "NY",
              "NC",
              "ND",
              "MP",
              "OH",
              "OK",
              "OR",
              "PW",
              "PA",
              "PR",
              "RI",
              "SC",
              "SD",
              "TN",
              "TX",
              "UT",
              "VT",
              "VI",
              "VA",
              "WA",
              "WV",
              "WI",
              "WY"
            ]
          },
          "postalCode":{
            "type":"string",
            "pattern":"^\\d{5}(?:[-\\s]\\d{4})?$",
            "example":"10011"
          },
          "country":{
            "type":"string",
            "example":"US",
            "enum":[
              "US"
            ]
          }
        },
        "required":[
          "line1",
          "city",
          "state",
          "postalCode",
          "country"
        ]
      },
      "BasePerson":{
        "title":"BasePerson",
        "type":"object",
        "description":"",
        "examples":[

        ],
        "properties":{
          "type":{
            "type":"string",
            "enum":[
              "control_person",
              "ubo"
            ]
          },
          "ssnToken":{
            "type":"string"
          },
          "userId":{
            "type":"string",
            "example":"0096c245-6b36-42db-b6e7-e78998504980",
            "format":"uuid"
          },
          "firstName":{
            "type":"string",
            "example":"Eytan"
          },
          "lastName":{
            "type":"string",
            "example":"Bensoussan"
          },
          "title":{
            "type":"string",
            "example":"CEO"
          },
          "email":{
            "type":"string",
            "format":"email",
            "example":"eytan@northone.com"
          },
          "phone":{
            "$ref":"#/components/schemas/PhoneNumber"
          },
          "cell":{
            "$ref":"#/components/schemas/PhoneNumber"
          },
          "dateOfBirth":{
            "type":"string",
            "format":"date",
            "example":"1997-10-31",
            "pattern":"^\\d{4}-\\d{2}-\\d{2}$"
          },
          "address":{
            "$ref":"#/components/schemas/Address"
          },
          "ownershipPercentage":{
            "type":"number",
            "minimum":0,
            "maximum":100,
            "example":100
          }
        },
        "required":[
          "type",
          "ssnToken",
          "firstName",
          "lastName",
          "title",
          "email",
          "phone",
          "dateOfBirth",
          "address",
          "ownershipPercentage"
        ]
      },
      "Person":{
        "title":"Person",
        "allOf":[
          {
            "type":"object",
            "properties":{
              "id":{
                "type":"string",
                "example":"person_01G12MXKZH6H5RE2WF034565VP"
              }
            },
            "required":[
              "id"
            ]
          },
          {
            "$ref":"#/components/schemas/BasePerson"
          }
        ],
        "description":""
      },
      "SharedBusiness":{
        "title":"SharedBusiness",
        "examples":[

        ],
        "type":"object",
        "description":"",
        "properties":{
          "type":{
            "type":"string"
          },
          "legalName":{
            "type":"string",
            "example":"123857239 Inc."
          },
          "dba":{
            "type":"string",
            "minLength":2,
            "example":"NorthOne"
          },
          "phone":{
            "$ref":"#/components/schemas/PhoneNumber"
          },
          "website":{
            "type":"string",
            "example":"https://www.example.com",
            "format":"uri"
          },
          "address":{
            "$ref":"#/components/schemas/Address"
          },
          "shippingAddress":{
            "$ref":"#/components/schemas/Address"
          },
          "naicsCode":{
            "type":"string",
            "description":"Industry classification code. [Learn More](https://www.census.gov/naics/)"
          },
          "description":{
            "type":"string"
          },
          "typeOfProductsOrServices":{
            "type":"string",
            "example":"Business Banking"
          },
          "numberOfEmployees":{
            "type":"number",
            "minimum":0,
            "example":100
          },
          "numberOfYearsAtLocation":{
            "type":"number",
            "minimum":0,
            "example":10
          },
          "annualRevenue":{
            "type":"number",
            "minimum":0,
            "example":100000
          }
        },
        "required":[
          "type",
          "legalName",
          "dba",
          "phone",
          "website",
          "address",
          "shippingAddress",
          "naicsCode",
          "description",
          "typeOfProductsOrServices",
          "numberOfEmployees",
          "numberOfYearsAtLocation",
          "annualRevenue"
        ]
      },
      "RegisteredBusiness":{
        "allOf":[
          {
            "$ref":"#/components/schemas/SharedBusiness"
          },
          {
            "type":"object",
            "properties":{
              "type":{
                "type":"string",
                "enum":[
                  "llc",
                  "corp",
                  "partnership"
                ]
              },
              "ein":{
                "type":"string",
                "example":"123456789"
              }
            },
            "required":[
              "type",
              "ein"
            ]
          }
        ],
        "title":"Registered Business"
      },
      "SoleProprietorship":{
        "title":"Sole Proprietorship",
        "allOf":[
          {
            "$ref":"#/components/schemas/SharedBusiness"
          },
          {
            "type":"object",
            "properties":{
              "type":{
                "type":"string",
                "enum":[
                  "soleprop"
                ]
              }
            },
            "required":[
              "type"
            ]
          }
        ]
      },
      "LLC":{
        "allOf":[
          {
            "$ref":"#/components/schemas/RegisteredBusiness"
          },
          {
            "type":"object",
            "properties":{
              "type":{
                "type":"string",
                "enum":[
                  "llc"
                ]
              }
            },
            "required":[
              "type"
            ]
          }
        ],
        "title":"LLC"
      },
      "Corporation":{
        "allOf":[
          {
            "$ref":"#/components/schemas/RegisteredBusiness"
          },
          {
            "type":"object",
            "properties":{
              "type":{
                "type":"string",
                "enum":[
                  "corp"
                ]
              }
            },
            "required":[
              "type"
            ]
          }
        ],
        "title":"Corporation"
      },
      "Partnership":{
        "title":"Partnership",
        "allOf":[
          {
            "$ref":"#/components/schemas/RegisteredBusiness"
          },
          {
            "type":"object",
            "properties":{
              "type":{
                "type":"string",
                "enum":[
                  "partnership"
                ]
              }
            },
            "required":[
              "type"
            ]
          }
        ]
      },
      "BaseBusiness":{
        "title":"Business",
        "examples":[

        ],
        "oneOf":[
          {
            "$ref":"#/components/schemas/LLC"
          },
          {
            "$ref":"#/components/schemas/SoleProprietorship"
          },
          {
            "$ref":"#/components/schemas/Corporation"
          },
          {
            "$ref":"#/components/schemas/Partnership"
          }
        ]
      },
      "Business":{
        "title":"BasePerson",
        "allOf":[
          {
            "type":"object",
            "properties":{
              "id":{
                "type":"string",
                "format":"uuid"
              }
            },
            "required":[
              "id"
            ]
          },
          {
            "$ref":"#/components/schemas/BaseBusiness"
          }
        ],
        "description":""
      },
      "BusinessUpdated":{
        "title":"customer-identity.updated",
        "type":"object",
        "properties":{
          "type":{
            "type":"string",
            "example":"customer-identity.updated"
          },
          "timestamp":{
            "type":"string",
            "format":"date-time"
          },
          "data":{
            "allOf":[
              {
                "$ref":"#/components/schemas/Business"
              },
              {
                "type":"object",
                "properties":{
                  "persons":{
                    "type":"array",
                    "items":{
                      "$ref":"#/components/schemas/Person"
                    }
                  }
                },
                "required":[
                  "persons"
                ]
              }
            ]
          }
        },
        "required":[
          "timestamp"
        ],
        "description":"Most likely will be broken in to multiple events."
      }
    },
    "responses":{
      "BusinessResponse":{
        "description":"Example response",
        "content":{
          "application/json":{
            "schema":{
              "allOf":[
                {
                  "$ref":"#/components/schemas/Business"
                },
                {
                  "type":"object",
                  "properties":{
                    "persons":{
                      "type":"array",
                      "items":{
                        "$ref":"#/components/schemas/Person"
                      }
                    }
                  },
                  "required":[
                    "persons"
                  ]
                }
              ]
            }
          }
        }
      },
      "PersonResponse":{
        "description":"Example response",
        "content":{
          "application/json":{
            "schema":{
              "$ref":"#/components/schemas/Person"
            }
          }
        }
      }
    },
    "requestBodies":{
      "BusinessPatchRequest":{
        "content":{
          "application/json":{
            "schema":{
              "type":"object",
              "properties":{
                "legalName":{
                  "type":"string"
                },
                "dba":{
                  "type":"string"
                },
                "phone":{
                  "type":"string"
                },
                "website":{
                  "type":"string"
                },
                "address":{
                  "$ref":"#/components/schemas/Address"
                }
              }
            }
          }
        }
      },
      "PersonPatchRequest":{
        "content":{
          "application/json":{
            "schema":{
              "type":"object",
              "properties":{
                "type":{
                  "type":"string",
                  "enum":[
                    "control_person",
                    "ubo"
                  ],
                  "description":"Confirm if this is required..."
                },
                "userId":{
                  "type":"string"
                },
                "firstName":{
                  "type":"string"
                },
                "lastName":{
                  "type":"string"
                },
                "ssnToken":{
                  "type":"string"
                },
                "email":{
                  "type":"string"
                },
                "phone":{
                  "type":"string"
                },
                "cell":{
                  "type":"string"
                },
                "dob":{
                  "type":"string"
                },
                "address":{
                  "$ref":"#/components/schemas/Address"
                },
                "title":{
                  "type":"string"
                },
                "ownershipPercentage":{
                  "type":"number",
                  "minimum":0,
                  "maximum":100
                }
              }
            }
          }
        }
      },
      "BusinessPostRequest":{
        "content":{
          "application/json":{
            "schema":{
              "allOf":[
                {
                  "$ref":"#/components/schemas/BaseBusiness"
                },
                {
                  "type":"object",
                  "properties":{
                    "persons":{
                      "type":"array",
                      "items":{
                        "$ref":"#/components/schemas/BasePerson"
                      }
                    }
                  }
                }
              ]
            }
          }
        }
      }
    },
    "parameters":{
      "businessId":{
        "name":"businessId",
        "in":"path",
        "required":true,
        "schema":{
          "type":"string",
          "format":"uuid",
          "example":"8cfbe0cb-5c4f-408f-9965-d7ae69572ef4"
        }
      },
      "personId":{
        "name":"personId",
        "in":"path",
        "required":true,
        "schema":{
          "type":"string",
          "example":"person_01G12MXKZH6H5RE2WF034565VP"
        }
      }
    },
    "examples":{

    }
  }
}